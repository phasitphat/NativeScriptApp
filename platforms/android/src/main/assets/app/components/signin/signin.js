"use strict";
var core_1 = require("@angular/core");
var page_1 = require("ui/page");
var router_1 = require("@angular/router");
var signin_services_1 = require("./signin.services");
var md5_1 = require("ts-md5/dist/md5");
var serverurl_1 = require("./../serverurl"); // get server test
var LocalStorage = require("nativescript-localstorage");
var SigninComponent = (function () {
    function SigninComponent(router, page, myService, server) {
        this.router = router;
        this.page = page;
        this.myService = myService;
        this.server = server;
        this.getusername = null;
        this.getpassword = null;
        this.i = 0;
    }
    SigninComponent.prototype.ngOnInit = function () {
        // before app start
        // LocalStorage.clear();
        console.log("SERVER : " + this.server.getserver());
        this.getid = LocalStorage.getItem("customer_id");
        console.log("Localstorage UserID (BEFORE SIGNIN): " + this.getid);
        this.page.actionBarHidden = true; // hide action bar
    };
    SigninComponent.prototype.login = function () {
        if (this.getusername == null && this.getpassword == null) {
            console.log("no input username or password");
            alert("Username or Password Incorrect");
        }
        else {
            this.extractData();
        }
    };
    SigninComponent.prototype.extractData = function () {
        var _this = this;
        console.log("extractData");
        // console.log("Username (INPUT) : " + this.getusername)
        // console.log("Password (INPUT) : " + this.getpassword)
        this.myService.getData()
            .subscribe(function (result) { return _this.onGetDataSuccess(result); }, function (error) { return _this.onGetDataError(error); });
    };
    SigninComponent.prototype.onGetDataSuccess = function (res) {
        console.log("onGetDataSuccess");
        this.getusername2 = this.getusername.toLowerCase();
        var e = md5_1.Md5.hashStr(this.getpassword);
        console.log("Username (INPUT) : " + this.getusername2);
        console.log("Password (INPUT) : " + e);
        for (var _i = 0, res_1 = res; _i < res_1.length; _i++) {
            var customer = res_1[_i];
            if (this.getid == customer.id) {
                this.i = 1;
                this.router.navigate(["/home"]);
            }
            else if (customer.username == this.getusername2 && customer.password == e) {
                LocalStorage.setItem("customer_id", customer.id); /// set
                this.getid = LocalStorage.getItem("customer_id"); /// get
                console.log("Customer id in localstorage (SIGNIN) : " + this.getid);
                this.i = 1;
                this.router.navigate(["/home"]);
            }
        }
        if (this.i == 0) {
            alert("Username or Password Incorrect");
        }
    };
    SigninComponent.prototype.onGetDataError = function (error) {
        var body = error.json() || "";
        var err = body.error || JSON.stringify(body);
        alert("Connection Error");
        console.log("onGetDataError: " + err);
    };
    SigninComponent.prototype.signup = function () {
        this.router.navigate(["signup"]); // come from path in routing ts
    };
    return SigninComponent;
}());
SigninComponent = __decorate([
    core_1.Component({
        selector: "signin",
        templateUrl: "./components/signin/signin.html",
        providers: [signin_services_1.MyHttpGetService, serverurl_1.ServerComponent]
    }),
    __metadata("design:paramtypes", [router_1.Router, page_1.Page, signin_services_1.MyHttpGetService, serverurl_1.ServerComponent])
], SigninComponent);
exports.SigninComponent = SigninComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lnbmluLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic2lnbmluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxzQ0FBa0Q7QUFDbEQsZ0NBQStCO0FBQy9CLDBDQUEyRDtBQUMzRCxxREFBcUQ7QUFDckQsdUNBQXNDO0FBQ3RDLDRDQUFpRCxDQUFDLGtCQUFrQjtBQUVwRSxJQUFJLFlBQVksR0FBRyxPQUFPLENBQUUsMkJBQTJCLENBQUUsQ0FBQztBQWMxRCxJQUFhLGVBQWU7SUFXeEIseUJBQTJCLE1BQWMsRUFBUyxJQUFVLEVBQVUsU0FBMkIsRUFBVSxNQUF1QjtRQUF2RyxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQVMsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUFVLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBaUI7UUFSM0gsZ0JBQVcsR0FBVyxJQUFJLENBQUM7UUFFM0IsZ0JBQVcsR0FBVyxJQUFJLENBQUM7UUFFM0IsTUFBQyxHQUFTLENBQUMsQ0FBQztJQUlpSCxDQUFDO0lBRXJJLGtDQUFRLEdBQVI7UUFDSSxtQkFBbUI7UUFDbkIsd0JBQXdCO1FBQ3hCLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxHQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQTtRQUVqRCxJQUFJLENBQUMsS0FBSyxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDakQsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1Q0FBdUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDakUsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLENBQUssa0JBQWtCO0lBQzVELENBQUM7SUFFTSwrQkFBSyxHQUFaO1FBQ0ksRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMs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QUFDLGtCQUFrQixHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFFTSxnQ0FBTSxHQUFiO1FBQ0ksSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQVUsK0JBQStCO0lBRTlFLENBQUM7SUFFTCxzQkFBQztBQUFELENBQUMsQUF2R0QsSUF1R0M7QUF2R1ksZUFBZTtJQVYzQixnQkFBUyxDQUFDO1FBRVAsUUFBUSxFQUFFLFFBQVE7UUFDbEIsV0FBVyxFQUFFLGlDQUFpQztRQUM5QyxTQUFTLEVBQUUsQ0FBQyxrQ0FBZ0IsRUFBQywyQkFBZSxDQUFDO0tBQ2hELENBQUM7cUNBZ0JxQyxlQUFNLEVBQWUsV0FBSSxFQUFxQixrQ0FBZ0IsRUFBa0IsMkJBQWU7R0FYekgsZUFBZSxDQXVHM0I7QUF2R1ksMENBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgeyBQYWdlIH0gZnJvbSBcInVpL3BhZ2VcIjtcbmltcG9ydCB7IFJvdXRlciwgTmF2aWdhdGlvbkV4dHJhcyB9IGZyb20gXCJAYW5ndWxhci9yb3V0ZXJcIjtcbmltcG9ydCB7IE15SHR0cEdldFNlcnZpY2UgfSBmcm9tIFwiLi9zaWduaW4uc2VydmljZXNcIjtcbmltcG9ydCB7IE1kNSB9IGZyb20gJ3RzLW1kNS9kaXN0L21kNSc7XG5pbXBvcnQgeyBTZXJ2ZXJDb21wb25lbnQgfSBmcm9tIFwiLi8uLi9zZXJ2ZXJ1cmxcIjsgLy8gZ2V0IHNlcnZlciB0ZXN0XG5cbmxldCBMb2NhbFN0b3JhZ2UgPSByZXF1aXJlKCBcIm5hdGl2ZXNjcmlwdC1sb2NhbHN0b3JhZ2VcIiApO1xuXG5cblxuQENvbXBvbmVudCh7XG5cbiAgICBzZWxlY3RvcjogXCJzaWduaW5cIixcbiAgICB0ZW1wbGF0ZVVybDogXCIuL2NvbXBvbmVudHMvc2lnbmluL3NpZ25pbi5odG1sXCIsXG4gICAgcHJvdmlkZXJzOiBbTXlIdHRwR2V0U2VydmljZSxTZXJ2ZXJDb21wb25lbnRdXG59KVxuICAgIFxuXG5cblxuZXhwb3J0IGNsYXNzIFNpZ25pbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdHtcbiAgICBcbiAgICBwdWJsaWMgZ2V0aWQ6IG51bWJlcjtcbiAgICBwdWJsaWMgZ2V0dXNlcm5hbWU6IHN0cmluZyA9IG51bGw7XG4gICAgcHVibGljIGdldHVzZXJuYW1lMjogc3RyaW5nO1xuICAgIHB1YmxpYyBnZXRwYXNzd29yZDogc3RyaW5nID0gbnVsbDtcblxuICAgIHB1YmxpYyBpOiBudW1iZXI9MDtcblxuXG5cbiAgICBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixwcml2YXRlIHBhZ2U6IFBhZ2UsIHByaXZhdGUgbXlTZXJ2aWNlOiBNeUh0dHBHZXRTZXJ2aWNlLCBwcml2YXRlIHNlcnZlcjogU2VydmVyQ29tcG9uZW50KXt9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgLy8gYmVmb3JlIGFwcCBzdGFydFxuICAgICAgICAvLyBMb2NhbFN0b3JhZ2UuY2xlYXIoKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJTRVJWRVIgOiBcIisgdGhpcy5zZXJ2ZXIuZ2V0c2VydmVyKCkpXG5cbiAgICAgICAgdGhpcy5nZXRpZCA9IExvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY3VzdG9tZXJfaWRcIik7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTG9jYWxzdG9yYWdlIFVzZXJJRCAoQkVGT1JFIFNJR05JTik6IFwiICsgdGhpcy5nZXRpZClcbiAgICAgICAgdGhpcy5wYWdlLmFjdGlvbkJhckhpZGRlbiA9IHRydWU7ICAgICAvLyBoaWRlIGFjdGlvbiBiYXJcbiAgICB9XG5cbiAgICBwdWJsaWMgbG9naW4oKSB7XG4gICAgICAgIGlmKHRoaXMuZ2V0dXNlcm5hbWUgPT0gbnVsbCAmJiB0aGlzLmdldHBhc3N3b3JkID09IG51bGwpe1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJubyBpbnB1dCB1c2VybmFtZSBvciBwYXNzd29yZFwiKVxuICAgICAgICAgICAgICAgIGFsZXJ0KFwiVXNlcm5hbWUgb3IgUGFzc3dvcmQgSW5jb3JyZWN0XCIpXG4gICAgICAgICAgICBcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB0aGlzLmV4dHJhY3REYXRhKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuXG4gICAgZXh0cmFjdERhdGEoKSB7XG5cbiAgICAgICAgY29uc29sZS5sb2coXCJleHRyYWN0RGF0YVwiKTtcblxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIlVzZXJuYW1lIChJTlBVVCkgOiBcIiArIHRoaXMuZ2V0dXNlcm5hbWUpXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiUGFzc3dvcmQgKElOUFVUKSA6IFwiICsgdGhpcy5nZXRwYXNzd29yZClcblxuICAgICAgICB0aGlzLm15U2VydmljZS5nZXREYXRhKClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAocmVzdWx0KSA9PiB0aGlzLm9uR2V0RGF0YVN1Y2Nlc3MocmVzdWx0KSxcbiAgICAgICAgICAgIChlcnJvcikgPT4gdGhpcy5vbkdldERhdGFFcnJvcihlcnJvcilcbiAgICAgICAgICAgICk7XG4gICAgfVxuXG5cblxuICAgIHByaXZhdGUgb25HZXREYXRhU3VjY2VzcyhyZXMpIHtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKFwib25HZXREYXRhU3VjY2Vzc1wiKTtcblxuICAgICAgICB0aGlzLmdldHVzZXJuYW1lMiA9IHRoaXMuZ2V0dXNlcm5hbWUudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICBsZXQgZSA9IE1kNS5oYXNoU3RyKHRoaXMuZ2V0cGFzc3dvcmQpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKFwiVXNlcm5hbWUgKElOUFVUKSA6IFwiICsgdGhpcy5nZXR1c2VybmFtZTIpXG4gICAgICAgIGNvbnNvbGUubG9nKFwiUGFzc3dvcmQgKElOUFVUKSA6IFwiICsgZSlcblxuICAgICAgICBmb3IgKGxldCBjdXN0b21lciBvZiByZXMpIHtcblxuICAgICAgICAgICAgaWYodGhpcy5nZXRpZD09Y3VzdG9tZXIuaWQpe1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgdGhpcy5pPTE7XG4gICAgICAgICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbXCIvaG9tZVwiXSlcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbHNlIGlmKGN1c3RvbWVyLnVzZXJuYW1lID09IHRoaXMuZ2V0dXNlcm5hbWUyICYmIGN1c3RvbWVyLnBhc3N3b3JkID09IGUpe1xuXG4gICAgICAgICAgICAgICAgTG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjdXN0b21lcl9pZFwiLCBjdXN0b21lci5pZCk7IC8vLyBzZXRcbiAgICAgICAgICAgICAgICB0aGlzLmdldGlkID0gTG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJjdXN0b21lcl9pZFwiKTsgLy8vIGdldFxuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJDdXN0b21lciBpZCBpbiBsb2NhbHN0b3JhZ2UgKFNJR05JTikgOiBcIiArIHRoaXMuZ2V0aWQpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5pPTE7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbXCIvaG9tZVwiXSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmKHRoaXMuaT09MCl7XG4gICAgICAgICAgICBhbGVydChcIlVzZXJuYW1lIG9yIFBhc3N3b3JkIEluY29ycmVjdFwiKTtcbiAgICAgICAgfVxuICAgICAgICBcblxuICAgIH1cblxuICAgIHByaXZhdGUgb25HZXREYXRhRXJyb3IoZXJyb3I6IFJlc3BvbnNlIHwgYW55KSB7XG4gICAgICAgIGNvbnN0IGJvZHkgPSBlcnJvci5qc29uKCkgfHwgXCJcIjtcbiAgICAgICAgY29uc3QgZXJyID0gYm9keS5lcnJvciB8fCBKU09OLnN0cmluZ2lmeShib2R5KTtcbiAgICAgICAgYWxlcnQoXCJDb25uZWN0aW9uIEVycm9yXCIpXG4gICAgICAgIGNvbnNvbGUubG9nKFwib25HZXREYXRhRXJyb3I6IFwiICsgZXJyKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2lnbnVwKCl7XG4gICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFtcInNpZ251cFwiXSk7ICAgICAgICAgIC8vIGNvbWUgZnJvbSBwYXRoIGluIHJvdXRpbmcgdHNcblxuICAgIH1cblxufVxuIl19