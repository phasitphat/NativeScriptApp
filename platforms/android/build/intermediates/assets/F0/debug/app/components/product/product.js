"use strict";
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var router_2 = require("@angular/router");
var product_services_1 = require("./product.services");
var serverurl_1 = require("./../serverurl"); // get server test
var LocalStorage = require("nativescript-localstorage");
var sequence = [0];
var countCart = 1;
var url = 0;
var ProductComponent = (function () {
    function ProductComponent(router, passing, myService, server) {
        this.router = router;
        this.passing = passing;
        this.myService = myService;
        this.server = server;
        this.product_id = null;
        this.i = 0;
        this.product_id_list = [];
        this.product_image_list = [];
        this.localid = LocalStorage.getItem("customer_id");
    }
    ProductComponent.prototype.ngOnInit = function () {
        var _this = this;
        // this.extractData()
        this.passing.params.subscribe(function (params) {
            _this.id = +params["id"];
        });
        console.log("constructor in product : " + this.id);
        if (sequence.length == 1) {
            LocalStorage.setItem("sequence", sequence);
        }
        sequence = LocalStorage.getItem("sequence"); /// get
        console.log("Secquence b4 : " + sequence);
        sequence.push(this.id); /// how to append sequence
        LocalStorage.setItem("sequence", sequence); /// set
        console.log("Secquence af : " + sequence);
        console.log("Secquence Length : " + sequence.length);
        // }
        if (sequence.length >= 3) {
            this.extractData();
            this.makePostSequenceRequest();
            this.extractDataPredict();
        }
        else {
            this.extractData();
        }
        // console.log("constructor in product : "+this.id); 
        // this.sequence.push(this.id)
        // console.log("Secquence : "+this.sequence);
    };
    ProductComponent.prototype.extractData = function () {
        var _this = this;
        console.log("extractData");
        this.myService.getData()
            .subscribe(function (result) { return _this.onGetDataSuccess(result); }, function (error) { return _this.onGetDataError(error); });
    };
    ProductComponent.prototype.extractDataPredict = function () {
        var _this = this;
        console.log("extractData");
        this.myService.getDataPredict()
            .subscribe(function (result) { return _this.onGetDataSuccessPredict(result); }, function (error) { return _this.onGetDataError(error); });
    };
    ProductComponent.prototype.onGetDataSuccess = function (res) {
        console.log("onGetDataSuccess");
        // console.log("onGetDataSuccess : "+JSON.stringify(res)) // res is list
        this.ran1 = Math.floor(Math.random() * res.length) + 1;
        this.ran2 = Math.floor(Math.random() * res.length) + 1;
        this.ran3 = Math.floor(Math.random() * res.length) + 1;
        this.ran4 = Math.floor(Math.random() * res.length) + 1;
        this.ran5 = Math.floor(Math.random() * res.length) + 1;
        this.ran6 = Math.floor(Math.random() * res.length) + 1;
        this.ran7 = Math.floor(Math.random() * res.length) + 1;
        this.ran8 = Math.floor(Math.random() * res.length) + 1;
        this.ran9 = Math.floor(Math.random() * res.length) + 1;
        this.ran10 = Math.floor(Math.random() * res.length) + 1;
        for (var _i = 0, res_1 = res; _i < res_1.length; _i++) {
            var product = res_1[_i];
            if (this.id == product.id) {
                this.product_id = product.id;
                console.log("res.id : " + product.id + " this.id : " + this.id);
                this.product_name = product.product_name;
                this.product_price = product.product_price;
                this.product_quantity = product.product_quantity;
                this.product_detail = product.product_detail;
                this.product_image = product.product_image;
            }
            if (sequence.length < 3) {
                if (product.id == this.ran1) {
                    this.product_id_list[0] = product.id;
                    this.product_image_list[0] = product.product_image;
                }
                if (product.id == this.ran2) {
                    this.product_id_list[1] = product.id;
                    this.product_image_list[1] = product.product_image;
                }
                if (product.id == this.ran3) {
                    this.product_id_list[2] = product.id;
                    this.product_image_list[2] = product.product_image;
                }
                if (product.id == this.ran4) {
                    this.product_id_list[3] = product.id;
                    this.product_image_list[3] = product.product_image;
                }
                if (product.id == this.ran5) {
                    this.product_id_list[4] = product.id;
                    this.product_image_list[4] = product.product_image;
                }
                if (product.id == this.ran6) {
                    this.product_id_list[5] = product.id;
                    this.product_image_list[5] = product.product_image;
                }
                if (product.id == this.ran7) {
                    this.product_id_list[6] = product.id;
                    this.product_image_list[6] = product.product_image;
                }
                if (product.id == this.ran8) {
                    this.product_id_list[7] = product.id;
                    this.product_image_list[7] = product.product_image;
                }
                if (product.id == this.ran9) {
                    this.product_id_list[8] = product.id;
                    this.product_image_list[8] = product.product_image;
                }
                if (product.id == this.ran10) {
                    this.product_id_list[9] = product.id;
                    this.product_image_list[9] = product.product_image;
                }
            }
        }
    };
    ProductComponent.prototype.onGetDataSuccessPredict = function (res) {
        console.log("onGetDataSuccess_Predict");
        // console.log("GET RES PREDICT : "+JSON.stringify(res)) // must be list
        // console.log("TEST : "+ JSON.stringify(res["queryset"]))
        for (var _i = 0, _a = res["queryset"]; _i < _a.length; _i++) {
            var product = _a[_i];
            var picture = JSON.stringify(product.product_image).slice(1, -1);
            ;
            console.log("URL : " + picture);
            if (this.i < 10) {
                this.product_id_list[this.i] = JSON.stringify(product.id);
                this.product_image_list[this.i] = this.server.getserver() + "media/" + picture;
                // console.log("Predict Product id : "+ this.product_id_list[this.i])
                // console.log("Predict Product image : "+this.product_image_list[this.i])
                this.i += 1;
            }
        }
    };
    ProductComponent.prototype.onGetDataError = function (error) {
        var body = error.json() || "";
        var err = body.error || JSON.stringify(body);
        console.log("onGetDataError: " + err);
    };
    ////////////////////////////////////// POST  //////////////////////////////////////////////
    ProductComponent.prototype.add = function () {
        countCart = LocalStorage.getItem("countCart");
        if (countCart <= 5) {
            if (this.product_id != null) {
                countCart += 1;
                LocalStorage.setItem("countCart", countCart);
                this.makePostRequest();
                this.makePostRequestCart();
            }
            else {
                alert("Please Wait");
            }
            console.log("Count Cart : " + countCart);
        }
        else {
            alert("Cart is full");
        }
    };
    ProductComponent.prototype.makePostRequest = function () {
        console.log("makePostRequest");
        this.myService
            .postData({
            product: this.product_id,
            customer: this.localid,
            totalprice_per_product: null,
            status_order: null,
        })
            .subscribe(function (res) {
        }, function (err) {
            console.log("Error : " + JSON.stringify(err));
        });
    };
    ProductComponent.prototype.makePostRequestCart = function () {
        console.log("makePostRequestCart");
        this.myService
            .postDataCart({
            product: this.product_id,
            customer: this.localid,
            totalprice_per_product: this.product_price,
        })
            .subscribe(function (res) {
            alert("Add to Cart Success");
        }, function (err) {
            alert("Add to Cart Error\nPlease try again");
            console.log("Error : " + JSON.stringify(err));
        });
    };
    ProductComponent.prototype.makePostSequenceRequest = function () {
        console.log("makePostSequenceRequest");
        var sequencelist = JSON.parse(JSON.stringify(sequence));
        console.log("sequencelist : " + sequencelist);
        this.myService.postSequenceData({
            sequencelist: sequencelist
        })
            .subscribe(function (res) {
            console.log("Post Sequence Success : " + JSON.stringify(res));
        }, function (err) {
            console.log("Error IN makePostSequenceRequest : " + err);
        });
    };
    ProductComponent.prototype.product = function (product_id) {
        if (product_id === void 0) { product_id = 0; }
        console.log("product_id : " + product_id);
        console.log("URL : " + url);
        if (product_id != 0 && url == 0) {
            this.router.navigate(["product1/", product_id]);
            url = 1;
        }
        else if (product_id != 0 && url == 1) {
            this.router.navigate(["product/", product_id]);
            url = 0;
        }
        if (product_id == 0) {
            alert("Please Wait");
        }
    };
    ProductComponent.prototype.cart = function () {
        this.router.navigate(["cart"]); // come from path in routing ts
    };
    ProductComponent.prototype.home = function () {
        this.router.navigate(["home"]); // come from path in routing ts
    };
    return ProductComponent;
}());
ProductComponent = __decorate([
    core_1.Component({
        selector: "product",
        templateUrl: "./components/product/product.html",
        providers: [product_services_1.MyHttpGetService, serverurl_1.ServerComponent]
    }),
    __metadata("design:paramtypes", [router_1.Router, router_2.ActivatedRoute, product_services_1.MyHttpGetService, serverurl_1.ServerComponent])
], ProductComponent);
exports.ProductComponent = ProductComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInByb2R1Y3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHNDQUEwQztBQUMxQywwQ0FBeUQ7QUFDekQsMENBQWlEO0FBQ2pELHVEQUFzRDtBQUN0RCw0Q0FBaUQsQ0FBQyxrQkFBa0I7QUFHcEUsSUFBSSxZQUFZLEdBQUcsT0FBTyxDQUFFLDJCQUEyQixDQUFFLENBQUM7QUFFMUQsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNuQixJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUM7QUFDbEIsSUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDO0FBV1osSUFBYSxnQkFBZ0I7SUE4QnpCLDBCQUEyQixNQUFjLEVBQVUsT0FBdUIsRUFBVSxTQUEyQixFQUFTLE1BQXVCO1FBQXBILFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxZQUFPLEdBQVAsT0FBTyxDQUFnQjtRQUFVLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQVMsV0FBTSxHQUFOLE1BQU0sQ0FBaUI7UUF6QjNJLGVBQVUsR0FBVyxJQUFJLENBQUM7UUFtQnZCLE1BQUMsR0FBVSxDQUFDLENBQUM7UUFFYixvQkFBZSxHQUFHLEVBQUUsQ0FBQztRQUNyQix1QkFBa0IsR0FBRyxFQUFFLENBQUM7UUFLM0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBRXZELENBQUM7SUFHRCxtQ0FBUSxHQUFSO1FBQUEsaUJBcUNDO1FBbkNHLHFCQUFxQjtRQUNyQixJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsVUFBQSxNQUFNO1lBQ2hDLEtBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUIsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixHQUFDLElBQUksQ0FBQyxF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dCI6WyJpbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgUm91dGVyLE5hdmlnYXRpb25FeHRyYXN9IGZyb20gXCJAYW5ndWxhci9yb3V0ZXJcIjtcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlIH0gZnJvbSBcIkBhbmd1bGFyL3JvdXRlclwiO1xuaW1wb3J0IHsgTXlIdHRwR2V0U2VydmljZSB9IGZyb20gXCIuL3Byb2R1Y3Quc2VydmljZXNcIjtcbmltcG9ydCB7IFNlcnZlckNvbXBvbmVudCB9IGZyb20gXCIuLy4uL3NlcnZlcnVybFwiOyAvLyBnZXQgc2VydmVyIHRlc3RcblxuaW1wb3J0IGRpYWxvZ3MgPSByZXF1aXJlKFwidWkvZGlhbG9nc1wiKTtcbmxldCBMb2NhbFN0b3JhZ2UgPSByZXF1aXJlKCBcIm5hdGl2ZXNjcmlwdC1sb2NhbHN0b3JhZ2VcIiApO1xuXG5sZXQgc2VxdWVuY2UgPSBbMF07IFxubGV0IGNvdW50Q2FydCA9IDE7XG5sZXQgdXJsID0gMDtcblxuQENvbXBvbmVudCh7XG5cbiAgICBzZWxlY3RvcjogXCJwcm9kdWN0XCIsXG4gICAgdGVtcGxhdGVVcmw6IFwiLi9jb21wb25lbnRzL3Byb2R1Y3QvcHJvZHVjdC5odG1sXCIsXG4gICAgcHJvdmlkZXJzOiBbTXlIdHRwR2V0U2VydmljZSxTZXJ2ZXJDb21wb25lbnRdXG5cbn0pXG5cblxuZXhwb3J0IGNsYXNzIFByb2R1Y3RDb21wb25lbnR7XG5cbiAgICBwdWJsaWMgbG9jYWxpZDogbnVtYmVyO1xuXG4gICAgcHVibGljIGlkOm51bWJlcjtcblx0cHVibGljIHByb2R1Y3RfaWQ6IG51bWJlciA9IG51bGw7XG4gICAgcHVibGljIHByb2R1Y3RfbmFtZTogc3RyaW5nO1xuICAgIHB1YmxpYyBwcm9kdWN0X3ByaWNlOiBudW1iZXI7XG4gICAgcHVibGljIHByb2R1Y3RfcXVhbnRpdHk6IG51bWJlcjtcbiAgICBwdWJsaWMgcHJvZHVjdF9kZXRhaWw6IHN0cmluZztcbiAgICBwdWJsaWMgcHJvZHVjdF9pbWFnZTogc3RyaW5nO1xuXG5cbiAgICBwdWJsaWMgcmFuMTpudW1iZXI7XG4gICAgcHVibGljIHJhbjI6bnVtYmVyO1xuICAgIHB1YmxpYyByYW4zOm51bWJlcjtcbiAgICBwdWJsaWMgcmFuNDpudW1iZXI7XG4gICAgcHVibGljIHJhbjU6bnVtYmVyO1xuICAgIHB1YmxpYyByYW42Om51bWJlcjtcbiAgICBwdWJsaWMgcmFuNzpudW1iZXI7XG4gICAgcHVibGljIHJhbjg6bnVtYmVyO1xuICAgIHB1YmxpYyByYW45Om51bWJlcjtcbiAgICBwdWJsaWMgcmFuMTA6bnVtYmVyO1xuXG4gICAgcHVibGljIGk6bnVtYmVyID0gMDtcblxuICAgIHB1YmxpYyBwcm9kdWN0X2lkX2xpc3QgPSBbXTtcbiAgICBwdWJsaWMgcHJvZHVjdF9pbWFnZV9saXN0ID0gW107XG5cblxuICAgIHB1YmxpYyBjb25zdHJ1Y3Rvcihwcml2YXRlIHJvdXRlcjogUm91dGVyLCBwcml2YXRlIHBhc3Npbmc6IEFjdGl2YXRlZFJvdXRlLCBwcml2YXRlIG15U2VydmljZTogTXlIdHRwR2V0U2VydmljZSxwcml2YXRlIHNlcnZlcjogU2VydmVyQ29tcG9uZW50KXtcblxuICAgICAgICB0aGlzLmxvY2FsaWQgPSBMb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImN1c3RvbWVyX2lkXCIpO1xuXG4gICAgfVxuICAgIFxuXG4gICAgbmdPbkluaXQoKSB7XG5cbiAgICAgICAgLy8gdGhpcy5leHRyYWN0RGF0YSgpXG4gICAgICAgIHRoaXMucGFzc2luZy5wYXJhbXMuc3Vic2NyaWJlKHBhcmFtcyA9PiB7XG4gICAgICAgICAgICB0aGlzLmlkID0gK3BhcmFtc1tcImlkXCJdO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKFwiY29uc3RydWN0b3IgaW4gcHJvZHVjdCA6IFwiK3RoaXMuaWQpOyBcblxuICAgICAgICBpZihzZXF1ZW5jZS5sZW5ndGggPT0gMSl7XG4gICAgICAgICAgICBMb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInNlcXVlbmNlXCIsIHNlcXVlbmNlKVxuICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIHNlcXVlbmNlID0gTG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJzZXF1ZW5jZVwiKTsgICAgIC8vLyBnZXRcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU2VjcXVlbmNlIGI0IDogXCIrc2VxdWVuY2UpXG4gICAgICAgICAgICBzZXF1ZW5jZS5wdXNoKHRoaXMuaWQpICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vIGhvdyB0byBhcHBlbmQgc2VxdWVuY2VcbiAgICAgICAgICAgIExvY2FsU3RvcmFnZS5zZXRJdGVtKFwic2VxdWVuY2VcIiwgc2VxdWVuY2UpOyAgICAgIC8vLyBzZXRcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU2VjcXVlbmNlIGFmIDogXCIrc2VxdWVuY2UpXG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU2VjcXVlbmNlIExlbmd0aCA6IFwiK3NlcXVlbmNlLmxlbmd0aClcbiAgICAgICAgLy8gfVxuXG5cbiAgICAgICAgaWYoc2VxdWVuY2UubGVuZ3RoID49IDMpe1xuICAgICAgICAgICAgdGhpcy5leHRyYWN0RGF0YSgpXG4gICAgICAgICAgICB0aGlzLm1ha2VQb3N0U2VxdWVuY2VSZXF1ZXN0KClcbiAgICAgICAgICAgIHRoaXMuZXh0cmFjdERhdGFQcmVkaWN0KCk7XG4gICAgICAgICAgICBcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuICAgICAgICAgICAgdGhpcy5leHRyYWN0RGF0YSgpXG4gICAgICAgIH1cblxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcImNvbnN0cnVjdG9yIGluIHByb2R1Y3QgOiBcIit0aGlzLmlkKTsgXG4gICAgICAgIC8vIHRoaXMuc2VxdWVuY2UucHVzaCh0aGlzLmlkKVxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIlNlY3F1ZW5jZSA6IFwiK3RoaXMuc2VxdWVuY2UpO1xuIFxuICAgIH1cblxuXG4gICAgZXh0cmFjdERhdGEoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZXh0cmFjdERhdGFcIik7XG4gICAgICAgIHRoaXMubXlTZXJ2aWNlLmdldERhdGEoKVxuICAgICAgICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgICAgIChyZXN1bHQpID0+IHRoaXMub25HZXREYXRhU3VjY2VzcyhyZXN1bHQpLFxuICAgICAgICAgICAgKGVycm9yKSA9PiB0aGlzLm9uR2V0RGF0YUVycm9yKGVycm9yKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBleHRyYWN0RGF0YVByZWRpY3QoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZXh0cmFjdERhdGFcIik7XG4gICAgICAgIHRoaXMubXlTZXJ2aWNlLmdldERhdGFQcmVkaWN0KClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAocmVzdWx0KSA9PiB0aGlzLm9uR2V0RGF0YVN1Y2Nlc3NQcmVkaWN0KHJlc3VsdCksXG4gICAgICAgICAgICAoZXJyb3IpID0+IHRoaXMub25HZXREYXRhRXJyb3IoZXJyb3IpXG4gICAgICAgICAgICApO1xuICAgIH1cblxuXG4gICAgcHJpdmF0ZSBvbkdldERhdGFTdWNjZXNzKHJlcykge1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coXCJvbkdldERhdGFTdWNjZXNzXCIpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIm9uR2V0RGF0YVN1Y2Nlc3MgOiBcIitKU09OLnN0cmluZ2lmeShyZXMpKSAvLyByZXMgaXMgbGlzdFxuXG4gICAgICAgIHRoaXMucmFuMSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHJlcy5sZW5ndGgpICsgMTtcbiAgICAgICAgdGhpcy5yYW4yID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcmVzLmxlbmd0aCkgKyAxO1xuICAgICAgICB0aGlzLnJhbjMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiByZXMubGVuZ3RoKSArIDE7XG4gICAgICAgIHRoaXMucmFuNCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHJlcy5sZW5ndGgpICsgMTtcbiAgICAgICAgdGhpcy5yYW41ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcmVzLmxlbmd0aCkgKyAxO1xuICAgICAgICB0aGlzLnJhbjYgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiByZXMubGVuZ3RoKSArIDE7XG4gICAgICAgIHRoaXMucmFuNyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHJlcy5sZW5ndGgpICsgMTtcbiAgICAgICAgdGhpcy5yYW44ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcmVzLmxlbmd0aCkgKyAxO1xuICAgICAgICB0aGlzLnJhbjkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiByZXMubGVuZ3RoKSArIDE7XG4gICAgICAgIHRoaXMucmFuMTAgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiByZXMubGVuZ3RoKSArIDE7XG5cbiAgICAgICAgZm9yIChsZXQgcHJvZHVjdCBvZiByZXMpIHtcblxuICAgICAgICAgICAgaWYodGhpcy5pZD09cHJvZHVjdC5pZCl7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RfaWQgPSAgcHJvZHVjdC5pZDtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInJlcy5pZCA6IFwiICsgcHJvZHVjdC5pZCArICBcIiB0aGlzLmlkIDogXCIgKyB0aGlzLmlkKTtcblxuICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdF9uYW1lID0gcHJvZHVjdC5wcm9kdWN0X25hbWU7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9kdWN0X3ByaWNlID0gcHJvZHVjdC5wcm9kdWN0X3ByaWNlO1xuICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdF9xdWFudGl0eSA9IHByb2R1Y3QucHJvZHVjdF9xdWFudGl0eTtcbiAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RfZGV0YWlsID0gcHJvZHVjdC5wcm9kdWN0X2RldGFpbDtcbiAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RfaW1hZ2UgPSBwcm9kdWN0LnByb2R1Y3RfaW1hZ2U7XG5cbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIlByb2R1Y3RfaW1hZ2U6IFwiK3RoaXMucHJvZHVjdF9pbWFnZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICBcbiAgICAgICAgICAgIGlmKHNlcXVlbmNlLmxlbmd0aCA8IDMpe1xuXG5cbiAgICAgICAgICAgICAgICBpZihwcm9kdWN0LmlkID09IHRoaXMucmFuMSl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdF9pZF9saXN0WzBdID0gcHJvZHVjdC5pZDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9kdWN0X2ltYWdlX2xpc3RbMF0gPSBwcm9kdWN0LnByb2R1Y3RfaW1hZ2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKHByb2R1Y3QuaWQgPT0gdGhpcy5yYW4yKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9kdWN0X2lkX2xpc3RbMV0gPSBwcm9kdWN0LmlkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RfaW1hZ2VfbGlzdFsxXSA9IHByb2R1Y3QucHJvZHVjdF9pbWFnZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYocHJvZHVjdC5pZCA9PSB0aGlzLnJhbjMpe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RfaWRfbGlzdFsyXSA9IHByb2R1Y3QuaWQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdF9pbWFnZV9saXN0WzJdID0gcHJvZHVjdC5wcm9kdWN0X2ltYWdlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihwcm9kdWN0LmlkID09IHRoaXMucmFuNCl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdF9pZF9saXN0WzNdID0gcHJvZHVjdC5pZDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9kdWN0X2ltYWdlX2xpc3RbM10gPSBwcm9kdWN0LnByb2R1Y3RfaW1hZ2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKHByb2R1Y3QuaWQgPT0gdGhpcy5yYW41KXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9kdWN0X2lkX2xpc3RbNF0gPSBwcm9kdWN0LmlkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RfaW1hZ2VfbGlzdFs0XSA9IHByb2R1Y3QucHJvZHVjdF9pbWFnZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYocHJvZHVjdC5pZCA9PSB0aGlzLnJhbjYpe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RfaWRfbGlzdFs1XSA9IHByb2R1Y3QuaWQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdF9pbWFnZV9saXN0WzVdID0gcHJvZHVjdC5wcm9kdWN0X2ltYWdlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihwcm9kdWN0LmlkID09IHRoaXMucmFuNyl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdF9pZF9saXN0WzZdID0gcHJvZHVjdC5pZDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9kdWN0X2ltYWdlX2xpc3RbNl0gPSBwcm9kdWN0LnByb2R1Y3RfaW1hZ2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKHByb2R1Y3QuaWQgPT0gdGhpcy5yYW44KXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9kdWN0X2lkX2xpc3RbN10gPSBwcm9kdWN0LmlkO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RfaW1hZ2VfbGlzdFs3XSA9IHByb2R1Y3QucHJvZHVjdF9pbWFnZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYocHJvZHVjdC5pZCA9PSB0aGlzLnJhbjkpe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RfaWRfbGlzdFs4XSA9IHByb2R1Y3QuaWQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdF9pbWFnZV9saXN0WzhdID0gcHJvZHVjdC5wcm9kdWN0X2ltYWdlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihwcm9kdWN0LmlkID09IHRoaXMucmFuMTApe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RfaWRfbGlzdFs5XSA9IHByb2R1Y3QuaWQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdF9pbWFnZV9saXN0WzldID0gcHJvZHVjdC5wcm9kdWN0X2ltYWdlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvbkdldERhdGFTdWNjZXNzUHJlZGljdChyZXMpIHtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKFwib25HZXREYXRhU3VjY2Vzc19QcmVkaWN0XCIpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIkdFVCBSRVMgUFJFRElDVCA6IFwiK0pTT04uc3RyaW5naWZ5KHJlcykpIC8vIG11c3QgYmUgbGlzdFxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIlRFU1QgOiBcIisgSlNPTi5zdHJpbmdpZnkocmVzW1wicXVlcnlzZXRcIl0pKVxuXG5cbiAgICAgICAgZm9yIChsZXQgcHJvZHVjdCBvZiByZXNbXCJxdWVyeXNldFwiXSkge1xuXG4gICAgICAgICAgICBsZXQgcGljdHVyZSA9IEpTT04uc3RyaW5naWZ5KHByb2R1Y3QucHJvZHVjdF9pbWFnZSkuc2xpY2UoMSwgLTEpOyA7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlVSTCA6IFwiK3BpY3R1cmUpXG5cbiAgICAgICAgICAgIGlmKHRoaXMuaSA8IDEwKXtcblxuICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdF9pZF9saXN0W3RoaXMuaV0gPSBKU09OLnN0cmluZ2lmeShwcm9kdWN0LmlkKTtcbiAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RfaW1hZ2VfbGlzdFt0aGlzLmldID0gdGhpcy5zZXJ2ZXIuZ2V0c2VydmVyKCkrXCJtZWRpYS9cIitwaWN0dXJlO1xuXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJQcmVkaWN0IFByb2R1Y3QgaWQgOiBcIisgdGhpcy5wcm9kdWN0X2lkX2xpc3RbdGhpcy5pXSlcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIlByZWRpY3QgUHJvZHVjdCBpbWFnZSA6IFwiK3RoaXMucHJvZHVjdF9pbWFnZV9saXN0W3RoaXMuaV0pXG5cbiAgICAgICAgICAgICAgICB0aGlzLmkgKz0gMVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICB9XG5cbiAgICB9XG5cblxuXG4gICAgcHJpdmF0ZSBvbkdldERhdGFFcnJvcihlcnJvcjogUmVzcG9uc2UgfCBhbnkpIHtcbiAgICAgICAgY29uc3QgYm9keSA9IGVycm9yLmpzb24oKSB8fCBcIlwiO1xuICAgICAgICBjb25zdCBlcnIgPSBib2R5LmVycm9yIHx8IEpTT04uc3RyaW5naWZ5KGJvZHkpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIm9uR2V0RGF0YUVycm9yOiBcIiArIGVycik7XG4gICAgfVxuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBQT1NUICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cblxuICAgIHB1YmxpYyBhZGQoKXtcblxuICAgICAgICBjb3VudENhcnQgPSBMb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImNvdW50Q2FydFwiKVxuICAgICAgICBcbiAgICAgICAgaWYoY291bnRDYXJ0IDw9IDUpe1xuXG4gICAgICAgICAgICBpZih0aGlzLnByb2R1Y3RfaWQgIT0gbnVsbCl7XG5cbiAgICAgICAgICAgICAgICBjb3VudENhcnQrPTFcbiAgICAgICAgICAgICAgICBMb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImNvdW50Q2FydFwiLCBjb3VudENhcnQpXG4gICAgICAgICAgICAgICAgdGhpcy5tYWtlUG9zdFJlcXVlc3QoKVxuICAgICAgICAgICAgICAgIHRoaXMubWFrZVBvc3RSZXF1ZXN0Q2FydCgpXG4gICAgICAgICAgICAgICAgXG5cbiAgICAgICAgICAgICAgICAvLyB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbXCJjYXJ0XCJdKTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwiUGxlYXNlIFdhaXRcIilcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJDb3VudCBDYXJ0IDogXCIgKyBjb3VudENhcnQpXG5cbiAgICAgICAgfWVsc2V7XG5cbiAgICAgICAgICAgIGFsZXJ0KFwiQ2FydCBpcyBmdWxsXCIpXG4gICAgICAgICAgICBcbiAgICAgICAgfVxuXG4gICAgICAgIFxuICAgIH1cblxuICAgIHByaXZhdGUgbWFrZVBvc3RSZXF1ZXN0KCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIm1ha2VQb3N0UmVxdWVzdFwiKTtcbiAgICAgICAgdGhpcy5teVNlcnZpY2VcbiAgICAgICAgICAgIC5wb3N0RGF0YSh7IFxuICAgICAgICAgICAgICAgIHByb2R1Y3Q6IHRoaXMucHJvZHVjdF9pZCxcbiAgICAgICAgICAgICAgICBjdXN0b21lcjogdGhpcy5sb2NhbGlkLFxuICAgICAgICAgICAgICAgIHRvdGFscHJpY2VfcGVyX3Byb2R1Y3Q6IG51bGwsXG4gICAgICAgICAgICAgICAgc3RhdHVzX29yZGVyOiBudWxsLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUocmVzID0+IHtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycj0+e1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgOiBcIitKU09OLnN0cmluZ2lmeShlcnIpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBtYWtlUG9zdFJlcXVlc3RDYXJ0KCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIm1ha2VQb3N0UmVxdWVzdENhcnRcIik7XG4gICAgICAgIHRoaXMubXlTZXJ2aWNlXG4gICAgICAgICAgICAucG9zdERhdGFDYXJ0KHsgXG4gICAgICAgICAgICAgICAgcHJvZHVjdDogdGhpcy5wcm9kdWN0X2lkLFxuICAgICAgICAgICAgICAgIGN1c3RvbWVyOiB0aGlzLmxvY2FsaWQsXG4gICAgICAgICAgICAgICAgdG90YWxwcmljZV9wZXJfcHJvZHVjdDogdGhpcy5wcm9kdWN0X3ByaWNlLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUocmVzID0+IHtcbiAgICAgICAgICAgICAgICBhbGVydChcIkFkZCB0byBDYXJ0IFN1Y2Nlc3NcIik7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnI9PntcbiAgICAgICAgICAgICAgICBhbGVydChcIkFkZCB0byBDYXJ0IEVycm9yXFxuUGxlYXNlIHRyeSBhZ2FpblwiKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIDogXCIrSlNPTi5zdHJpbmdpZnkoZXJyKSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgbWFrZVBvc3RTZXF1ZW5jZVJlcXVlc3QoKSB7XG5cbiAgICBjb25zb2xlLmxvZyhcIm1ha2VQb3N0U2VxdWVuY2VSZXF1ZXN0XCIpO1xuXG4gICAgbGV0IHNlcXVlbmNlbGlzdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoc2VxdWVuY2UpKTtcbiAgICBjb25zb2xlLmxvZyhcInNlcXVlbmNlbGlzdCA6IFwiK3NlcXVlbmNlbGlzdClcblxuICAgIHRoaXMubXlTZXJ2aWNlLnBvc3RTZXF1ZW5jZURhdGEoeyBcblxuICAgICAgICAgICAgc2VxdWVuY2VsaXN0XG5cbiAgICAgICAgfSlcbiAgICAgICAgLnN1YnNjcmliZShyZXMgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJQb3N0IFNlcXVlbmNlIFN1Y2Nlc3MgOiBcIitKU09OLnN0cmluZ2lmeShyZXMpKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyPT57XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIElOIG1ha2VQb3N0U2VxdWVuY2VSZXF1ZXN0IDogXCIrZXJyKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIHB1YmxpYyBwcm9kdWN0KHByb2R1Y3RfaWQ9MCl7XG5cbiAgICAgICAgY29uc29sZS5sb2coXCJwcm9kdWN0X2lkIDogXCIrcHJvZHVjdF9pZClcbiAgICAgICAgY29uc29sZS5sb2coXCJVUkwgOiBcIit1cmwpXG5cbiAgICAgICAgaWYocHJvZHVjdF9pZCAhPSAwICYmIHVybCA9PSAwKXtcbiAgICAgICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFtcInByb2R1Y3QxL1wiLHByb2R1Y3RfaWRdKTtcbiAgICAgICAgICAgIHVybCA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZihwcm9kdWN0X2lkICE9IDAgJiYgdXJsID09IDEpe1xuICAgICAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoW1wicHJvZHVjdC9cIixwcm9kdWN0X2lkXSk7XG4gICAgICAgICAgICB1cmwgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYocHJvZHVjdF9pZCA9PSAwKXtcbiAgICAgICAgICAgIGFsZXJ0KFwiUGxlYXNlIFdhaXRcIilcbiAgICAgICAgfVxuXG4gICAgfVxuXG5cdHB1YmxpYyBjYXJ0KCl7XG5cblx0XHR0aGlzLnJvdXRlci5uYXZpZ2F0ZShbXCJjYXJ0XCJdKTsgICAgICAgICAgLy8gY29tZSBmcm9tIHBhdGggaW4gcm91dGluZyB0c1xuXG5cdH1cblxuICAgIHB1YmxpYyBob21lKCl7XG5cbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoW1wiaG9tZVwiXSk7ICAgICAgICAgIC8vIGNvbWUgZnJvbSBwYXRoIGluIHJvdXRpbmcgdHNcblxuICAgIH1cblxufVxuXG5cbiAgICBcbiAgICAiXX0=